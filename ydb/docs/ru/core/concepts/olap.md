# OLAP

[Online analytical processing (OLAP)](https://ru.wikipedia.org/wiki/OLAP) или интерактивная аналитическая обработка — это подход к обработке данных, позволяющий оперативно получать в структурированном виде срез из большого массива данных для их последующего анализа.

В отличие от online transaction processing (OLTP), OLAP в основном предназначен для анализа данных с более низким числом транзакций, но со значительно большим объемом обрабатываемых данных.

## Архитектура

Архитектурно база данных разделена на два слоя: хранения и вычисления. Слой хранения отвечает за надёжное и распределённое размещение данных. А слой вычисления делает всё остальное: выполняет над данными запросы, балансирует нагрузку в кластере, предоставляет сервисные функции для управления кластером.

Архитектура {{ ydb-short-name }} — едина для обоих типов нагрузок: OLTP и OLAP. Подробно об архитектуре {{ ydb-short-name }} см. в [Обзоре YDB](./index.md#ydb-architecture).

## Колоночные таблицы

В {{ ydb-short-name }} существует два основных типа таблиц — [строковые](./datamodel/table.md##row-oriented-tables) и [колоночные](./datamodel/table.md##column-oriented-tables). Для аналитических запросов в основном используются колоночные таблицы<!--, но {{ ydb-short-name }} также позволяет комбинировать запросы к колоночным и строчным таблицам в одной транзакции-->.

Колоночные таблицы {{ ydb-short-name }} хранят данные каждого столбца отдельно (независимо) от других столбцов. Такой принцип хранения данных оптимизирован для использования c OLAP-нагрузками, так как при построении аналитических отчетов часто используются лишь несколько столбцов из витрины данных и колоночное хранение позволяет считывать только те столбцы, которые непосредственно участвуют в запросе.

Аналитические запросы выполняются над большими объемами данных. {{ ydb-short-name }} позволяет максимально эффективно фильтровать столбцы колоночных таблиц и читать только те части столбцов, которые нужны для выполнения запросов.

Партиционирование колоночных таблиц выполняется не по первичному ключу, а по хэшу от него, чтобы один аналитический запрос можно было выполнять параллельно на нескольких серверных процессах {{ ydb-short-name }}, что позволяет эффективно обрабатывать терабайты данных.

Для широких колоночных таблиц (витрин данных) часто используются ненормализованные данные, и записи в таких таблицах часто содержат NULL-значения в неиспользуемых столбцах. Таблицы, в которых много пустых ячеек называют разреженными (sparse). Чтобы пустые
ячейки не занимали место на диске, {{ ydb-short-name }} использует две технологии эффективного
хранения разреженных таблиц:

- Если пустых ячеек немного, то {{ ydb-short-name }} хранит вместе с данными битовую маску, которая определяет, в каких ячейках есть данные.
- Если пустых ячеек много, то {{ ydb-short-name }} хранит только пары индекс-значение.

## Преимущества {{ ydb-short-name }}

В основе преимуществ {{ ydb-short-name }} лежит её архитектура:

1. **Разделение слоёв для вычислений и для хранения данных** позволяет точечно расширять кластер {{ ydb-short-name }}:

    - Если в кластере {{ ydb-short-name }} достаточно ресурсов для хранения, но значительно увеличилось количество запросов к данным, достаточно добавить узлов баз данных для ускорения обработки запросов.

    - Если кластер {{ ydb-short-name }} справляется с обработкой запросов, но количество данных постоянно растёт, необходимо добавить узлов хранения.

1. **Единая платформа**. {{ ydb-short-name }} позволяет совмещать OLTP- и OLAP-нагрузки в рамках одной базы данных.

<!-- 1. При добавлении новых серверов в кластер {{ ydb-short-name }} необходимо максимально равномерно распределить данные по кластеру, чтобы обрабатывать их параллельно для скорейшего получения результата. **Перешардирование данных** в колоночных таблицах {{ ydb-short-name }} происходит почти мгновенно. Кроме того, при перешардировании колоночных таблиц кластер {{ ydb-short-name }} продолжает обрабатывать поступающие запросы пользователей. -->

## Сценарии

{{ ydb-short-name }} оптимизирована для работы с большими объёмами данных и применяется в сценариях, где требуется эффективная обработка, хранение и анализ данных.

- **Observability**. {{ ydb-short-name }} может использоваться как хранилище телеметрических данных (метрики, логи, трейсы) для обеспечения полной наблюдаемости различных систем.

    <!-- Благодаря поддержке широких таблиц, которые могут включать до 10000 колонок, {{ ydb-short-name }} позволяет создавать витрины для разнородных событий с большим числом полей, что особенно важно для логирования и трассировки сложных систем. -->

    <!-- Кроме того, {{ ydb-short-name }} поддерживает использование S3-совместимых хранилищ и охлаждение данных, что позволяет экономно масштабировать хранение исторических данных без потери в доступности. Такая архитектура делает её подходящей как для оперативного мониторинга, так и для длительного хранения данных с возможностью последующего анализа. -->

- **Аналитическая БД**. {{ ydb-short-name }} может применяться для выполнения сложной аналитики над большими объёмами данных. Она поддерживает стоимостной оптимизатор запросов и перешардирование колоночных таблиц, что делает её подходящей для построения отчётности, дашбордов и проведения ретроспективного анализа событий в системах.
<!-- Что-нибудь ещё? -->

## Аналитические возможности {{ ydb-short-name }}

{{ ydb-short-name }} — это распределённая реляционная база данных, оптимизированная для гибкой загрузки, хранения и аналитической обработки больших данных. Система поддерживает интеграцию с внешними источниками и BI-инструментами, а также сочетает возможности OLTP и OLAP.

- Загрузка данных

    - Параллельная загрузка больших объёмов данных с высокой производительностью.
    - Федеративные запросы: перенос данных из внешних источников (PostgreSQL, Greenplum, S3) для ETL/ELT-сценариев.
    - Шины данных: автоматическая загрузка и синхронизация данных, поддержка CDC.
    - Интеграция: подключение инструментов (FluentBit, LogStash), импорт из JDBC-источников.

- Хранение данных

    - Колоночные таблицы для OLAP<!--, поддержка до 10 000 колонок, смешанные запросы (OLAP+OLTP)-->.
    - Workload Manager: управление ресурсами для пользовательских запросов.
    <!-- - Охлаждение данных: автоматический перенос в S3 с прозрачным доступом и возможностью выполнения SQL-запросов. -->

- Обработка и анализ

    - Стоимостной оптимизатор: построение эффективных планов выполнения аналитических запросов.
    - Интеграция с BI: работа с аналитическими системами (Apache Superset, DataLens, FineBI, Grafana).
    <!-- - DBT -->

## Смотри также

- [{#T}](../analyst/index.md)
- [{#T}](../dev/query-plans-optimization.md)
- [{#T}](../integrations/ingestion/index.md)
- [{#T}](../dev/resource-consumption-management.md)
